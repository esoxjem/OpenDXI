#!/usr/bin/env bash
set -e

# Clean up stale processes and PID files
echo "ðŸ§¹ Cleaning up..."

# Remove stale Rails PID file
rm -f api/tmp/pids/server.pid

# Kill any processes on ports 3000 (Rails) and 3001 (Next.js)
lsof -ti :3000 -ti :3001 2>/dev/null | xargs kill -9 2>/dev/null || true

echo "ðŸš€ Starting development servers..."

# Check for overmind or foreman
if command -v overmind &> /dev/null; then
  exec overmind start -f Procfile.dev "$@"
elif command -v foreman &> /dev/null; then
  exec foreman start -f Procfile.dev "$@"
else
  echo "Please install overmind (recommended) or foreman:"
  echo ""
  echo "  brew install overmind    # macOS"
  echo "  gem install foreman      # Ruby"
  echo ""
  exit 1
fi
